@page "/"
@using CodeTestV2.Core.Interfaces.Services
@using CodeTestV2.Application.Models
@inject IEmployeeService<Response, Employee> EmployeeService

<div style="display:flex;flex-direction:row">
    <h1>Employee Editor</h1>
    <div class="content-container">
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div style="display: flex; flex-direction: column">
                <span>Something went wrong here are some details</span>
                <span style="color: red">@errorMessage</span>
            </div>
        }
        else
        {
            <EmployeeEditor OnEmployeeUpdated="OnEmployeeUpdated" EmployeeCollection="employeeData"/>
        }
    </div>
</div>

@code
{
    IList<Employee> employeeData = new List<Employee>();

    string errorMessage = string.Empty;


    protected override Task OnInitializedAsync()
    {
        return OnEmployeeFetchAsync();
    }

    private Task OnEmployeeUpdated()
    {
        return OnEmployeeFetchAsync();
    }

    private async Task OnEmployeeFetchAsync()
    {
        employeeData.Clear();
        errorMessage = string.Empty;

        try
        {
            var result = await EmployeeService.ListEmployees(new Request(0, 30), CancellationToken.None);
            employeeData = result.Data;
        }
        catch (Exception e)
        {
            errorMessage = e.Message;
        }

    }

}
